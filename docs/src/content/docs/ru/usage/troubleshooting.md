---
title: Устранение неполадок
description: Устранение неполадок
tableOfContents:
  minHeadingLevel: 2
  maxHeadingLevel: 4
---

## Распространенные проблемы

### Проблемы с подпиской

#### Некорректный ответ URL подписки

```
error parsing subscription: error getting subscription: unexpected status code: 403
```

**Возможные причины:**

- Неверный URL
- URL больше не действителен
- Сервер блокирует user agent Xray Checker

**Решения:**

1. Проверьте URL подписки
2. Проверьте, активен ли еще URL
3. Свяжитесь с провайдером подписки
4. Попробуйте использовать формат Base64 напрямую вместо URL

#### Ошибка декодирования Base64

```
error decoding Base64: illegal base64 data...
```

**Возможные причины:**

- Неверная кодировка Base64
- URL-safe против стандартного Base64
- Дополнительные пробелы или переносы строк

**Решения:**

1. Убедитесь, что строка Base64 чистая, без пробелов
2. Попробуйте декодирование URL-safe Base64, если стандартное не работает
3. Проверьте, нужно ли декодировать содержимое несколько раз

### Проблемы с проверкой прокси

#### Запуск на прокси-сервере

При запуске Xray Checker на том же сервере, где размещены ваши прокси, вы **должны** использовать метод проверки `status` вместо метода `ip` по умолчанию.

**Почему:**

- Метод проверки `ip` сравнивает ваш IP с прокси и без него
- При запуске на прокси-сервере оба IP будут одинаковыми
- Это вызывает ложные срабатывания - рабочие прокси отмечаются как неработающие

**Решение:**

```bash
# В переменных окружения
PROXY_CHECK_METHOD=status
PROXY_STATUS_CHECK_URL=http://cp.cloudflare.com/generate_204

# Или через CLI
--proxy-check-method=status --proxy-status-check-url="http://cp.cloudflare.com/generate_204"
```

#### Все прокси не работают

```
Warning: error parsing proxy URL: connection refused
```

**Возможные причины:**

- Проблемы с сетевым подключением
- Брандмауэр блокирует соединения
- Сервис проверки IP недоступен

**Решения:**

1. Проверьте сетевое подключение
2. Проверьте правила брандмауэра
3. Попробуйте альтернативный метод проверки:
   ```bash
   PROXY_CHECK_METHOD=status
   ```
4. Используйте альтернативный сервис проверки IP:
   ```bash
   PROXY_IP_CHECK_URL=http://ip.sb
   ```

#### Высокая задержка или таймауты

```
Warning: error getting current IP: timeout
```

**Возможные причины:**

- Медленное сетевое соединение
- Сервис проверки IP медленный
- Слишком низкий таймаут прокси

**Решения:**

1. Увеличьте таймаут:
   ```bash
   PROXY_TIMEOUT=60
   ```
2. Используйте более быстрый сервис проверки IP
3. Отключите симуляцию задержки:
   ```bash
   SIMULATE_LATENCY=false
   ```

### Проблемы с метриками

#### Нет доступа к метрикам

```
Error: Unauthorized
```

**Возможные причины:**

- Включена аутентификация
- Неверные учетные данные
- Неверный порт

**Решения:**

1. Проверьте, включена ли аутентификация:
   ```bash
   METRICS_PROTECTED=false
   ```
2. Проверьте учетные данные:
   ```bash
   METRICS_USERNAME=user
   METRICS_PASSWORD=pass
   ```
3. Проверьте правильность порта:
   ```bash
   METRICS_PORT=2112
   ```

#### Ошибки Pushgateway

```
Error pushing metrics: unexpected status code 401
```

**Возможные причины:**

- Неверный URL pushgateway
- Требуется аутентификация
- Проблемы с сетью

**Решения:**

1. Проверьте формат URL:
   ```bash
   METRICS_PUSH_URL="http://user:pass@host:9091"
   ```
2. Проверьте сетевое подключение
3. Проверьте логи pushgateway

### Конфликты портов

#### Порт уже используется

```
error starting server: listen tcp :2112: bind: address already in use
```

**Возможные причины:**

- Другой сервис использует порт
- Предыдущий экземпляр все еще работает
- Системные ограничения портов

**Решения:**

1. Измените порт метрик:
   ```bash
   METRICS_PORT=2113
   ```
2. Проверьте запущенные процессы:
   ```bash
   lsof -i :2112
   ```
3. Остановите конфликтующие сервисы

#### Проблемы с диапазоном портов SOCKS

```
error starting Xray: port already in use
```

**Возможные причины:**

- Конфликт диапазона портов
- Слишком много прокси
- Системные ограничения портов

**Решения:**

1. Измените начальный порт:
   ```bash
   XRAY_START_PORT=20000
   ```
2. Проверьте системные ограничения:
   ```bash
   ulimit -n
   ```
3. Освободите диапазон портов

## Методы отладки

### Включение отладочного логирования

```bash
XRAY_LOG_LEVEL=debug
```

Отладочный лог покажет:

- Попытки подключения
- Разбор конфигурации
- Детали ошибок
- Информацию о времени

### Проверка статуса процесса

```bash
# Проверка запущенного процесса
ps aux | grep xray-checker

# Проверка открытых портов
netstat -tulpn | grep xray-checker
```

### Проверка сетевого подключения

```bash
# Тест сервиса проверки IP
curl -v https://api.ipify.org?format=text

# Тест прокси-соединения
curl --socks5 localhost:10000 -v https://api.ipify.org?format=text
```

### Отладка Docker

```bash
# Проверка логов контейнера
docker logs xray-checker

# Доступ к оболочке контейнера
docker exec -it xray-checker sh

# Проверка сети контейнера
docker inspect xray-checker
```

## Получение помощи

Если у вас все еще есть проблемы:

1. Проверьте GitHub Issues на наличие похожих проблем
2. Создайте новый issue с:

   - Полным сообщением об ошибке
   - Используемой конфигурацией
   - Отладочными логами
   - Шагами для воспроизведения

3. Укажите детали окружения:
   - Версия ОС
   - Версия Docker (если используется)
   - Версия Xray Checker
